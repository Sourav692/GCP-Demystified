Streaming analytics and dashboards
Data visualization tools can help you make sense of your BigQuery data and help you analyze the data interactively. You can use visualization tools to help you identify trends, respond to them, and make predictions using your data. In this lab, you use Google Data Studio to visualize data in the BigQuery table populated by your Dataflow pipeline in the previous exercise.

What you need
To complete this lab, you need:

Access to a supported Internet browser:

The latest version of Google Chrome, Firefox, or Microsoft Edge
Microsoft Internet Explorer 11+
Safari 8+ (Safari private mode is not supported)
A Google Cloud Platform project

What you learn
In this lab, you:

Connect to a BigQuery data source
Create reports and charts to visualize BigQuery data
Begin the lab
https://codelabs.developers.google.com/codelabs/cpb104-bigquery-datastudio/

## Lab Review
In the previous two labs that we have done so far we looked at how you could take sensor data and publish it into Pub/Sub, and then we looked at how you could write a Dataflow pipeline to process that sensor data, compute things like current conditions and average speeds. So what I've done now, is that essentially repeated those steps to publish the data into a Pub/Sub and then have gone ahead and in another Cloud Shell window, I've launched two Dataflow pipelines. The two pipelines; one to compute the average speed, the other to compute average concurrent conditions, and have basically gone ahead and started running those two pipelines. One for average speeds, and one for the current conditions and they're both writing into BigQuery and then we looked at how you could do streaming queries on the stream in BigQuery. But what we will do in this lab is that we'll write a Data Studio dashboard that will go ahead and process this data, create nice impactful dashboards of it. So we will go into datastudio. google.com and once we are in datastudio.google.com, I'll go ahead and start a new report. And in this report, I will ask to create a new data source and my data source is going to be from BigQuery, and I have to say which project that I'm going to be getting it from. So cloud training demos and my dataset is called Demos and I have a table called Current Conditions and I can connect to it. So at this point, Data Studio comes back and says, "Aha. Those are your columns, you have latitude, you have highway, you have lane," and then it looks at what each of these columns are and says latitude is a number highway is the text, lane is a number and it also talks about what the right thing to do. If for example you're looking at an hour of latitude data. What should you do with it? And it thinks that we should sum up the latitudes. Well summing up is the kind of thing that you do for things like amounts, money, right, you may want to find a total of sales, for example. It doesn't make sense for something like a latitude, so we could change this aggregation and we could say what you want to do with an aggregation is maybe find the average latitude of all of the stuff, but the highway is just text we don't need to do anything. The lane again, we probably don't need to do anything. We could just do none there. The speed average makes more sense. Timestamp, our timestamp is actually no, it's not just date, it's date and time. So let's go ahead and pick the highest resolution there. My longitude again. Average makes sense. So the direction and sensor ID idea are both text. So we could do this. We could also, if we wanted, add extra things, right extra calculations for example, if you wanted to do them. So let's try that. OK. And let's call this the number of vehicles. So these are the number of vehicles that we have seen so far, and that is essentially going to be the count of what? Count of pretty much any field. It could be the count of the highway, the sensor ID, the timestamp whatever it is it's just a count because of any number of rules. So let's just do a count of sensor ID and we will go ahead and create a field, and that is now a formula that we have done. And let's go ahead and add this to the report, and we'll add it to the report. So at this point now, we have a report. We don't have a title for it. Let's just say the title is going to be you'll want to show our current conditions. Current Conditions in San Diego. And we can say that what we want to do is we want to create a bar chart that shows for every highway, how many vehicles we have seen so far in that highway. So now the data sources Current Conditions, the dimension, the way I think about it is a dimension is like the X-axis. The dimension is the highway. So that's Highway 5, Highway 8, Highway 8 or 5 etc. and the metric is a number of vehicles. This has happened to be the default. So that's because they happened to be the first thing. But let's go ahead and do something else. So that's just to show you what others we could do. Let's change this metric instead of num vehicles. Let's go ahead and show the speed. So we can say go ahead and show the speed. And so now we're basically seeing the speed for each of the highways. They are all around 70 miles per hour. And again remember that when we did the speed we said compute the average speed. So this is the average speed that we're seeing. And we could change the style, if we wanted, to really- we'll leave that as it is. Let's go ahead and do something else. Let's change the data source. So let's go ahead and add a different data source. So now let's do another time series. But here we will change this datasource. Oh this is the datasource. I hit on time series, and as you can see we are basically getting the change in the number of vehicles over time. So what I happen to do here was I said give me the time series, and now I get the variation of time series over time, as we're collecting this data. So that's another thing that we've just added to our report. Let's go back and add a new page, and in this page let's maybe do a map. So we can do a map, and in the map we need a dimension, but the dimension has to be something geographic. So let's go back and look at what we have available to us in here. So we have current conditions. We have the latitude and we have the longitude. So we needed a geofilter. So let's go ahead and add a calculated field that is latlong, and this would be the concatenation of latitude and a comma, and you want to concatenate this again, with the longitude and this now, we can create a field. Latitude and longitude. What do I need to do?

Oh, I see longitude and latitude are the averages. We just make them none first, and then we should be able to do this. Let me try that. And there we go. So we have a latitude and we'll say this thing is not really text. It is actually a geographic of latitude, longitude and we have changed it, and we will do Done and we'll come back in here, and we'll say that our dimension is the latlong and we basically get a geographic map of number of vehicles that we could change. So, we don't have to the number of vehicles, let's do speed. And so now we have this speed and this is actually not zoomed in enough. So what we'll do is we'll change the zoom area from say the world and let's just make it, actually we can just search for, let's say California. There it is. Search for California. There we go and of course we can change this. We can edit it. We can make our dashboard a lot more impactful. But this gives you the idea. Let's go ahead and make a new page as well. So file, add a new page, and let's this time, add a new data source as well, because remember we're just doing Current Conditions. Let's go ahead and do these speeds as well. So, let's see. How do I get the new data source? Let's work here and add a new data source. There is my data sources, add one. So that would be BigQuery and I'll go into cloud training demos. And this time I will do average speeds, and I'll connect to it. So at this point, now I have the same fields. Let's leave these as it is. But let's say that we want to show the average speed this time of every lane. And let's create a report. So this is now another report. Add it, and again as before we can do a bar chart, and in the bar chart our dimension is going to be by highway or metric. We don't want to display latitude. We wanted to display the speed. So let's change that to speed. And dispose of the average. We could also do something smarter. We could add a metric, and the metric, we could create a new metric, and this metric, what we could do is that we could add a new metric called Min speed which will be the min of the speed. We can create that field, the speed, we'll just make that none and let's change this to create the speed. And let's do another field which is the max speed which should be the max of the speed. And the reason we needed to change this to none is because we want this to be the original data so we can compute the max on it. If you've already averaged it then we have lost the max. So let's also do the average speed. Which could be the average of the speed and let's create that field, and we can be done and now in our metric picture we can say we want to pick the average speed. Go back and change this to be the max speed. So we have the max speed, we have the average speed and we have the min speed. So now we have all three of these, and we don't really want to have the same color, so we can go back to the style and say don't do single color, do multiple colors, and there we go. So this is now the, at every highway, the maximum, the minimum and the average speeds that you're seeing and the cool thing here- to me the coolest thing is. You can basically take this report. Let's say these are the speeds and the highways. So highway speeds, San Diego highway speeds, and we can say Go ahead and share this report and you can provide a Gmail address, send it to that person, and at that point you can go back to your email and that person that you've sent it to will be able to basically come and look at this report. And in fact, I'm now in my personal e-mail account and I see that this report has shown up, and I can basically go and click on this report and there it is. Right. We will be at the point of being able to share this. And in this case, I've shared it, such that I can edit it, so this other person can hit edit and add new things and change them. Look at the values and refresh the view. It's a pretty powerful way of collaborating with dashboards. 
